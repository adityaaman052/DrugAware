<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafePath - Drug Awareness Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .nav-logo i {
            font-size: 2rem;
            color: #4facfe;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover {
            color: #4facfe;
            transform: translateY(-2px);
        }

        .nav-link.active {
            color: #4facfe;
        }

        /* Hero Section */
        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><circle cx="200" cy="200" r="100" fill="url(%23a)"/><circle cx="800" cy="300" r="80" fill="url(%23a)"/><circle cx="400" cy="800" r="120" fill="url(%23a)"/></svg>');
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            padding: 2rem;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .cta-button {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
        }

        /* Game Section */
        .game-section {
            min-height: 100vh;
            padding: 2rem 0;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            display: none;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .game-header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }

        .game-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .game-instructions {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        /* Game Stats */
        .game-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-radius: 15px;
            text-align: center;
            color: white;
            min-width: 120px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Game Canvas */
        .game-canvas-container {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        #gameCanvas {
            width: 100%;
            height: 400px;
            border-radius: 15px;
            background: linear-gradient(180deg, #87CEEB 0%, #4682B4 50%, #2F4F4F 100%);
            display: block;
            margin: 0 auto;
        }

        /* Question Modal */
        .question-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .question-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .question-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .question-modal.active .question-card {
            transform: scale(1);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: #333;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .option-btn.correct {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            animation: pulse 0.5s ease-in-out;
        }

        .option-btn.incorrect {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            animation: shake 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Game Controls */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .control-btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Game Over Modal */
        .game-over-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .game-over-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .game-over-content {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .game-over-modal.active .game-over-content {
            transform: scale(1);
        }

        .game-over-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #333;
        }

        .final-score {
            font-size: 3rem;
            font-weight: 700;
            color: #4facfe;
            margin-bottom: 2rem;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .score-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .score-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .score-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .game-stats {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .stat-item {
                min-width: 100px;
                padding: 0.8rem 1rem;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .game-controls {
                flex-wrap: wrap;
            }
        }

        /* Loading Animation */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Character Animation */
        .character {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #FFD700;
            border-radius: 50%;
            transition: all 0.5s ease;
            border: 3px solid #FFA500;
            z-index: 10;
        }

        .character::before {
            content: '🧭';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
        }

        /* Marble Animation */
        .marble {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .marble:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }

        .marble.option-a { background: linear-gradient(45deg, #FF6B6B, #FF8E8E); }
        .marble.option-b { background: linear-gradient(45deg, #4ECDC4, #7FDBDA); }
        .marble.option-c { background: linear-gradient(45deg, #45B7D1, #6CC5E0); }
        .marble.option-d { background: linear-gradient(45deg, #96CEB4, #A8D5BA); }

        .marble.sink {
            animation: sink 0.5s ease-in-out forwards;
        }

        @keyframes sink {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(50px) scale(0.5); opacity: 0; }
        }

        /* Water ripple effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.6);
            animation: ripple 1s ease-out;
            pointer-events: none;
        }

        @keyframes ripple {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                width: 100px;
                height: 100px;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-shield-alt"></i>
                <span>SafePath</span>
            </div>
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link active">Home</a></li>
                <li><a href="#game" class="nav-link">Game</a></li>
                <li><a href="#about" class="nav-link">About</a></li>
                <li><a href="#resources" class="nav-link">Resources</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Choose Your Path Wisely</h1>
            <p>Navigate through challenging waters and make informed decisions about drug awareness. 
               Learn while you play in this interactive educational journey that tests your knowledge 
               and helps you understand the consequences of different choices.</p>
            <button class="cta-button" onclick="startGame()">
                <i class="fas fa-play"></i>
                Start Your Journey
            </button>
        </div>
    </section>

    <!-- Game Section -->
    <section class="game-section" id="gameSection">
        <div class="game-container">
            <div class="game-header">
                <h2 class="game-title">River Crossing Challenge</h2>
                <p class="game-instructions">
                    Guide your character across the river by choosing the correct marble for each question. 
                    Wrong choices will sink into the water!
                </p>
            </div>

            <!-- Game Stats -->
            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-value" id="score">0</div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="lives">3</div>
                    <div class="stat-label">Lives</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="streak">0</div>
                    <div class="stat-label">Streak</div>
                </div>
            </div>

            <!-- Game Canvas -->
            <div class="game-canvas-container">
                <canvas id="gameCanvas" width="800" height="400"></canvas>
            </div>

            <!-- Game Controls -->
            <div class="game-controls">
                <button class="control-btn" id="startBtn" onclick="initializeGame()">
                    <i class="fas fa-play"></i> Start Game
                </button>
                <button class="control-btn" id="pauseBtn" onclick="pauseGame()" style="display: none;">
                    <i class="fas fa-pause"></i> Pause
                </button>
                <button class="control-btn" id="resetBtn" onclick="resetGame()">
                    <i class="fas fa-refresh"></i> Reset
                </button>
                <button class="control-btn" id="hintBtn" onclick="useHint()">
                    <i class="fas fa-lightbulb"></i> Hint (3)
                </button>
            </div>
        </div>
    </section>

    <!-- Question Modal -->
    <div class="question-modal" id="questionModal">
        <div class="question-card">
            <h3 class="question-text" id="questionText"></h3>
            <div class="options-grid" id="optionsGrid"></div>
            <div id="feedback" style="margin-top: 1rem; font-weight: 600;"></div>
            <button class="control-btn" id="nextBtn" onclick="nextQuestion()" style="display: none; margin-top: 1rem;">
                <i class="fas fa-arrow-right"></i> Continue
            </button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="game-over-modal" id="gameOverModal">
        <div class="game-over-content">
            <h2 class="game-over-title">Journey Complete!</h2>
            <div class="final-score" id="finalScore">0</div>
            <div class="score-breakdown">
                <div class="score-item">
                    <div class="score-value" id="finalCorrect">0</div>
                    <div class="score-label">Correct</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="finalAccuracy">0%</div>
                    <div class="score-label">Accuracy</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="finalLevel">1</div>
                    <div class="score-label">Level</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="finalStreak">0</div>
                    <div class="score-label">Best Streak</div>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button class="control-btn" onclick="resetGame()">
                    <i class="fas fa-play"></i> Play Again
                </button>
                <button class="control-btn" onclick="closeGameOver()">
                    <i class="fas fa-home"></i> Home
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game Questions Database
        const questions = [
            {
                question: "What is the most effective way to prevent drug addiction?",
                options: ["Education and awareness", "Strict punishment", "Ignoring the problem", "Peer pressure"],
                correct: 0,
                explanation: "Education and awareness are the most effective prevention methods as they help people make informed decisions."
            },
            {
                question: "Which of these is NOT a warning sign of drug abuse?",
                options: ["Sudden mood changes", "Declining grades", "Regular exercise", "Neglecting appearance"],
                correct: 2,
                explanation: "Regular exercise is actually a healthy activity, not a warning sign of drug abuse."
            },
            {
                question: "What should you do if a friend offers you drugs?",
                options: ["Take them to fit in", "Say no confidently", "Report them immediately", "Make excuses"],
                correct: 1,
                explanation: "Saying no confidently is the best response. True friends will respect your decision."
            },
            {
                question: "Which substance is most commonly abused by teenagers?",
                options: ["Cocaine", "Alcohol", "Heroin", "Marijuana"],
                correct: 1,
                explanation: "Alcohol is the most commonly abused substance among teenagers due to its accessibility."
            },
            {
                question: "What is the first step in drug addiction recovery?",
                options: ["Detoxification", "Acknowledging the problem", "Finding new friends", "Changing location"],
                correct: 1,
                explanation: "Acknowledging the problem is the first and most important step in the recovery process."
            },
            {
                question: "Which factor increases the risk of drug addiction?",
                options: ["Good grades", "Strong family support", "Mental health issues", "Regular sleep"],
                correct: 2,
                explanation: "Mental health issues like depression and anxiety can increase the risk of drug addiction."
            },
            {
                question: "What is the legal drinking age in most countries?",
                options: ["16", "18", "21", "25"],
                correct: 2,
                explanation: "The legal drinking age is 21 in many countries, including the United States."
            },
            {
                question: "Which of these is a healthy way to deal with stress?",
                options: ["Using drugs", "Exercise and meditation", "Isolation", "Aggressive behavior"],
                correct: 1,
                explanation: "Exercise and meditation are healthy, effective ways to manage stress and improve mental health."
            },
            {
                question: "What percentage of people who try drugs become addicted?",
                options: ["10%", "25%", "50%", "75%"],
                correct: 0,
                explanation: "Approximately 10% of people who try drugs develop addiction, but this varies by substance."
            },
            {
                question: "Which is the most important factor in preventing relapse?",
                options: ["Avoiding all friends", "Strong support system", "Changing jobs", "Moving away"],
                correct: 1,
                explanation: "A strong support system of family, friends, and professionals is crucial for preventing relapse."
            }
        ];

        // Game State
       // 1. MODIFY: Update game state initialization (around line 550)
let gameState = {
    score: 0,
    lives: 3,
    level: 1,
    streak: 0,
    currentQuestion: 0,
    totalQuestions: 10, // Changed from questions.length to fixed 10 levels
    correctAnswers: 0,
    isGameActive: false,
    isPaused: false,
    hintsRemaining: 3,
    characterPosition: { x: 50, y: 350 },
    marbles: [],
    riverWidth: 800,
    stepSize: 70, // Distance between marble rows
    currentStep: 0,
    questionDisplayed: false
};

        // Canvas and Context
        let canvas, ctx;
        let character, marbles = [];

       // 6. MODIFY: Update initializeGame function (around line 590)
function initializeGame() {
    canvas = document.getElementById('gameCanvas');
    ctx = canvas.getContext('2d');
    
    // Start game
    document.getElementById('startBtn').style.display = 'none';
    document.getElementById('pauseBtn').style.display = 'inline-block';
    
    gameState.isGameActive = true;
    gameState.currentQuestion = 0;
    gameState.currentStep = 0;
    
    // Show first question and create marbles
    showNextLevel();
}

        // Start the game from hero section
        function startGame() {
            document.getElementById('home').style.display = 'none';
            document.getElementById('gameSection').style.display = 'block';
            
            // Smooth scroll to game section
            document.getElementById('gameSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Draw the game canvas
       // 2. MODIFY: Update drawGame function (around line 650)
function drawGame() {
    if (!ctx) return;
    
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Draw river background
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#87CEEB');
    gradient.addColorStop(0.5, '#4682B4');
    gradient.addColorStop(1, '#2F4F4F');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Draw river waves
    drawWaves();
    
    // Draw character
    drawCharacter();
    
    // Draw marbles
    drawMarbles();
    
    // Draw progress indicator
    drawProgress();
    
    // Draw current question at top
    if (gameState.isGameActive && !gameState.isPaused) {
        drawCurrentQuestion();
    }
}

        // Draw animated waves
        function drawWaves() {
            const time = Date.now() * 0.002;
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                const yOffset = 50 + i * 70;
                for (let x = 0; x < canvas.width; x += 5) {
                    const y = yOffset + Math.sin((x * 0.01) + time + i) * 10;
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
        }

        // Draw character
        function drawCharacter() {
            const { x, y } = gameState.characterPosition;
            
            // Character body
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI * 2);
            ctx.fill();
            
            // Character border
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Character face
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x - 6, y - 5, 2, 0, Math.PI * 2);
            ctx.arc(x + 6, y - 5, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // Character smile
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x, y + 2, 8, 0, Math.PI);
            ctx.stroke();
        }

       function drawMarbles() {
    marbles.forEach((marble, index) => {
        if (!marble.sunk) {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
            const letters = ['A', 'B', 'C', 'D'];
            
            // Marble body
            ctx.fillStyle = colors[index];
            ctx.beginPath();
            ctx.arc(marble.x, marble.y, marble.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // Marble border
            ctx.strokeStyle = marble.hovered ? 'rgba(255, 255, 255, 1)' : 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = marble.hovered ? 4 : 2;
            ctx.stroke();
            
            // Marble letter
            ctx.fillStyle = 'white';
            ctx.font = 'bold 20px Poppins';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(letters[index], marble.x, marble.y - 5);
            
            // Option text below marble
            ctx.fillStyle = 'white';
            ctx.font = '10px Poppins';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            ctx.fillText(marble.text, marble.x, marble.y + marble.radius + 5);
        }
    });
}

        // Draw progress indicator
        function drawProgress() {
            const progressWidth = (gameState.currentQuestion / gameState.totalQuestions) * (canvas.width - 40);
            
            // Progress background
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.fillRect(20, 20, canvas.width - 40, 8);
            
            // Progress fill
            ctx.fillStyle = '#4facfe';
            ctx.fillRect(20, 20, progressWidth, 8);
            
            // Progress text
            ctx.fillStyle = 'white';
            ctx.font = '14px Poppins';
            ctx.textAlign = 'center';
            ctx.fillText(`Question ${gameState.currentQuestion + 1} of ${gameState.totalQuestions}`, canvas.width / 2, 45);
        }

      // 4. MODIFY: Update createMarbles function (around line 730)
function createMarbles() {
    if (gameState.currentQuestion >= questions.length) return;
    
    marbles = [];
    const question = questions[gameState.currentQuestion];
    const marbleY = 250; // Position marbles in middle of screen
    const spacing = (canvas.width - 200) / 4;
    
    for (let i = 0; i < 4; i++) {
        marbles.push({
            x: 100 + i * spacing,
            y: marbleY,
            radius: 30,
            sunk: false,
            hovered: false,
            option: i,
            text: question.options[i].substring(0, 15) + (question.options[i].length > 15 ? '...' : '') // Truncate long options
        });
    }
}
      // 7. REPLACE: Replace showQuestion function (around line 800)
function showNextLevel() {
    if (gameState.currentQuestion >= 10) { // Win condition - 10 levels
        winGame();
        return;
    }
    
    // Randomize question selection
    gameState.currentQuestion = Math.floor(Math.random() * questions.length);
    
    // Create marbles for this question
    createMarbles();
    drawGame();
    
    // Update level every 2 questions
    if (gameState.currentStep > 0 && gameState.currentStep % 2 === 0) {
        gameState.level++;
        updateStats();
    }
}
function winGame() {
    gameState.isGameActive = false;
    
    // Calculate final stats
    const accuracy = Math.round((gameState.correctAnswers / gameState.currentStep) * 100);
    
    // Update final score display
    document.getElementById('finalScore').textContent = gameState.score + 1000; // Bonus for winning
    document.getElementById('finalCorrect').textContent = gameState.correctAnswers;
    document.getElementById('finalAccuracy').textContent = accuracy + '%';
    document.getElementById('finalLevel').textContent = gameState.level;
    document.getElementById('finalStreak').textContent = gameState.streak;
    
    // Update game over title to show win
    document.getElementById('gameOverModal').querySelector('.game-over-title').textContent = 'Victory! River Crossed!';
    
    // Show game over modal
    document.getElementById('gameOverModal').classList.add('active');
    
    // Play victory sound
    playSound('victory');
}

        // Handle answer selection
        function selectAnswer(selectedIndex) {
            const question = questions[gameState.currentQuestion];
            const options = document.querySelectorAll('.option-btn');
            const feedback = document.getElementById('feedback');
            
            // Disable all options
            options.forEach(option => option.disabled = true);
            
            if (selectedIndex === question.correct) {
                // Correct answer
                options[selectedIndex].classList.add('correct');
                feedback.textContent = '✅ Correct! ' + question.explanation;
                feedback.style.color = '#4CAF50';
                
                // Update game state
                gameState.score += 100 + (gameState.streak * 10);
                gameState.streak++;
                gameState.correctAnswers++;
                
                // Move character forward
                animateCharacterMove(selectedIndex);
                
                // Play success sound (if available)
                playSound('success');
                
            } else {
                // Wrong answer
                options[selectedIndex].classList.add('incorrect');
                options[question.correct].classList.add('correct');
                feedback.textContent = '❌ Wrong! ' + question.explanation;
                feedback.style.color = '#f44336';
                
                // Update game state
                gameState.lives--;
                gameState.streak = 0;
                
                // Sink the wrong marble
                sinkMarble(selectedIndex);
                
                // Play error sound (if available)
                playSound('error');
                
                if (gameState.lives <= 0) {
                    setTimeout(() => {
                        endGame();
                    }, 2000);
                    return;
                }
            }
            
            // Update stats
            updateStats();
            
            // Show next button
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        // Animate character movement
        function animateCharacterMove(marbleIndex) {
            const targetX = marbles[marbleIndex].x;
            const startX = gameState.characterPosition.x;
            const distance = targetX - startX;
            const duration = 1000; // 1 second
            const startTime = Date.now();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for smooth movement
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                
                gameState.characterPosition.x = startX + (distance * easeProgress);
                
                // Add jumping effect
                if (progress < 0.5) {
                    gameState.characterPosition.y = 350 - (Math.sin(progress * Math.PI * 2) * 30);
                } else {
                    gameState.characterPosition.y = 350;
                }
                
                drawGame();
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    gameState.characterPosition.y = 350;
                    drawGame();
                }
            }
            
            animate();
        }

        // Sink marble animation
        function sinkMarble(marbleIndex) {
            const marble = marbles[marbleIndex];
            const startY = marble.y;
            const duration = 1000;
            const startTime = Date.now();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                marble.y = startY + (progress * 100);
                marble.radius = 25 * (1 - progress * 0.5);
                
                drawGame();
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    marble.sunk = true;
                    drawGame();
                }
            }
            
            animate();
        }
        // 10. ADD: New function to handle marble selection (add after selectAnswer function)
function selectMarble(marbleIndex) {
    if (gameState.currentQuestion >= questions.length) return;
    
    const question = questions[gameState.currentQuestion];
    
    if (marbleIndex === question.correct) {
        // Correct answer
        gameState.score += 100 + (gameState.streak * 10);
        gameState.streak++;
        gameState.correctAnswers++;
        gameState.currentStep++;
        
        // Move character forward
        animateCharacterMove(marbleIndex);
        
        // Play success sound
        playSound('success');
        
        // Show next level after animation
        setTimeout(() => {
            showNextLevel();
        }, 1500);
        
    } else {
        // Wrong answer
        gameState.lives--;
        gameState.streak = 0;
        
        // Sink the wrong marble
        sinkMarble(marbleIndex);
        
        // Play error sound
        playSound('error');
        
        if (gameState.lives <= 0) {
            setTimeout(() => {
                endGame();
            }, 2000);
            return;
        } else {
            // Show same question again after 2 seconds
            setTimeout(() => {
                createMarbles();
                drawGame();
            }, 2000);
        }
    }
    
    // Update stats
    updateStats();
}

        // Next question
        function nextQuestion() {
            gameState.currentQuestion++;
            document.getElementById('questionModal').classList.remove('active');
            
            if (gameState.currentQuestion < gameState.totalQuestions) {
                // Level up every 3 questions
                if (gameState.currentQuestion % 3 === 0) {
                    gameState.level++;
                }
                
                setTimeout(() => {
                    showQuestion();
                }, 500);
            } else {
                endGame();
            }
        }

        // Update game statistics
        function updateStats() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('streak').textContent = gameState.streak;
        }

        // Use hint
        function useHint() {
            if (gameState.hintsRemaining > 0 && document.getElementById('questionModal').classList.contains('active')) {
                gameState.hintsRemaining--;
                document.getElementById('hintBtn').innerHTML = `<i class="fas fa-lightbulb"></i> Hint (${gameState.hintsRemaining})`;
                
                // Remove two wrong options
                const question = questions[gameState.currentQuestion];
                const options = document.querySelectorAll('.option-btn');
                let removed = 0;
                
                options.forEach((option, index) => {
                    if (removed < 2 && index !== question.correct) {
                        option.style.display = 'none';
                        removed++;
                    }
                });
                
                if (gameState.hintsRemaining === 0) {
                    document.getElementById('hintBtn').disabled = true;
                }
                
                // Reduce score for using hint
                gameState.score = Math.max(0, gameState.score - 20);
                updateStats();
            }
        }

        // Pause game
        function pauseGame() {
            gameState.isPaused = !gameState.isPaused;
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (gameState.isPaused) {
                pauseBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
                document.getElementById('questionModal').classList.remove('active');
            } else {
                pauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                if (gameState.isGameActive) {
                    document.getElementById('questionModal').classList.add('active');
                }
            }
        }
        function drawCurrentQuestion() {
    if (gameState.currentQuestion >= questions.length) return;
    
    const question = questions[gameState.currentQuestion];
    
    // Draw question background
    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
    ctx.fillRect(20, 60, canvas.width - 40, 80);
    
    // Draw question text
    ctx.fillStyle = 'white';
    ctx.font = 'bold 16px Poppins';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    
    // Wrap text if too long
    const words = question.question.split(' ');
    let line = '';
    let y = 85;
    
    for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        
        if (testWidth > canvas.width - 80 && n > 0) {
            ctx.fillText(line, canvas.width / 2, y);
            line = words[n] + ' ';
            y += 20;
        } else {
            line = testLine;
        }
    }
    ctx.fillText(line, canvas.width / 2, y);
}

        // Reset game
        function resetGame() {
            gameState = {
                score: 0,
                lives: 3,
                level: 1,
                streak: 0,
                currentQuestion: 0,
                totalQuestions: questions.length,
                correctAnswers: 0,
                isGameActive: false,
                isPaused: false,
                hintsRemaining: 3,
                characterPosition: { x: 50, y: 350 },
                marbles: []
            };
            
            // Reset UI
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('hintBtn').innerHTML = '<i class="fas fa-lightbulb"></i> Hint (3)';
            document.getElementById('hintBtn').disabled = false;
            document.getElementById('questionModal').classList.remove('active');
            document.getElementById('gameOverModal').classList.remove('active');
            
            updateStats();
            drawGame();
        }

        // End game
        function endGame() {
            gameState.isGameActive = false;
            document.getElementById('questionModal').classList.remove('active');
            document.getElementById('pauseBtn').style.display = 'none';
            
            // Calculate final stats
            const accuracy = Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100);
            
            // Update final score display
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalCorrect').textContent = gameState.correctAnswers;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            document.getElementById('finalLevel').textContent = gameState.level;
            document.getElementById('finalStreak').textContent = gameState.streak;
            
            // Show game over modal
            document.getElementById('gameOverModal').classList.add('active');
            
            // Play end game sound
            playSound('gameOver');
        }

        // Close game over modal
        function closeGameOver() {
            document.getElementById('gameOverModal').classList.remove('active');
            document.getElementById('gameSection').style.display = 'none';
            document.getElementById('home').style.display = 'block';
            resetGame();
        }

        // Play sound effects (placeholder function)
        function playSound(soundType) {
            // This would play actual sounds if audio files were available
            // For now, we'll use a visual feedback system
            const canvas = document.getElementById('gameCanvas');
            
            if (soundType === 'success') {
                canvas.style.boxShadow = '0 0 20px #4CAF50';
                setTimeout(() => {
                    canvas.style.boxShadow = 'none';
                }, 200);
            } else if (soundType === 'error') {
                canvas.style.boxShadow = '0 0 20px #f44336';
                setTimeout(() => {
                    canvas.style.boxShadow = 'none';
                }, 200);
            }
        }

      // 11. MODIFY: Update canvas click event (around line 1100)
document.getElementById('gameCanvas').addEventListener('click', function(e) {
    if (!gameState.isGameActive || gameState.isPaused) return;
    
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    // Check if click is on a marble
    marbles.forEach((marble, index) => {
        const distance = Math.sqrt(Math.pow(x - marble.x, 2) + Math.pow(y - marble.y, 2));
        if (distance <= marble.radius && !marble.sunk) {
            selectMarble(index);
        }
    });
});

        // Canvas mouse move for hover effects
        document.getElementById('gameCanvas').addEventListener('mousemove', function(e) {
            if (!gameState.isGameActive) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            let hoverChanged = false;
            
            marbles.forEach((marble, index) => {
                const distance = Math.sqrt(Math.pow(x - marble.x, 2) + Math.pow(y - marble.y, 2));
                const wasHovered = marble.hovered;
                marble.hovered = distance <= marble.radius && !marble.sunk;
                
                if (marble.hovered !== wasHovered) {
                    hoverChanged = true;
                }
            });
            
            if (hoverChanged) {
                drawGame();
                canvas.style.cursor = marbles.some(m => m.hovered) ? 'pointer' : 'default';
            }
        });

        // Initialize canvas when page loads
        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = 800;
            canvas.height = 400;
            
            // Initial draw
            drawGame();
            
            // Animation loop for water effects
            function animateWater() {
                if (gameState.isGameActive && !gameState.isPaused) {
                    drawGame();
                }
                requestAnimationFrame(animateWater);
            }
            animateWater();
        });

        // Smooth navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const target = this.getAttribute('href');
                
                if (target === '#home') {
                    document.getElementById('gameSection').style.display = 'none';
                    document.getElementById('home').style.display = 'block';
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                } else if (target === '#game') {
                    startGame();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

      // 9. MODIFY: Update keyboard controls (around line 1200)
document.addEventListener('keydown', function(e) {
    if (gameState.isGameActive && !gameState.isPaused) {
        if (e.key >= '1' && e.key <= '4') {
            const index = parseInt(e.key) - 1;
            if (marbles[index] && !marbles[index].sunk) {
                selectMarble(index);
            }
        }
        
        // Arrow key controls
        if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
            selectMarble(0);
        } else if (e.key === 'ArrowDown' || e.key === 's' || e.key === 'S') {
            selectMarble(1);
        } else if (e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') {
            selectMarble(2);
        } else if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
            selectMarble(3);
        }
    }
    
    // Pause with spacebar
    if (e.key === ' ' && gameState.isGameActive) {
        e.preventDefault();
        pauseGame();
    }
});

        // Additional educational content and awareness messages
        const awarenessMessages = [
            "Remember: It's always okay to say NO to drugs!",
            "True friends respect your decision to stay drug-free.",
            "Your mental health matters - seek help when needed.",
            "Education is your best defense against addiction.",
            "Every choice you make shapes your future.",
            "Recovery is possible with the right support system.",
            "You have the power to make positive choices.",
            "Being drug-free means being truly free."
        ];

        // Show random awareness message
        function showAwarenessMessage() {
            const message = awarenessMessages[Math.floor(Math.random() * awarenessMessages.length)];
            // Could be displayed in a notification or tooltip
            console.log("Awareness Message:", message);
        }

        // Show awareness message every 30 seconds during gameplay
        setInterval(() => {
            if (gameState.isGameActive) {
                showAwarenessMessage();
            }
        }, 30000);

        // Responsive canvas resizing
        function resizeCanvas() {
            const container = document.querySelector('.game-canvas-container');
            const containerWidth = container.offsetWidth - 32; // Account for padding
            const aspectRatio = 800 / 400;
            
            if (containerWidth < 800) {
                canvas.style.width = containerWidth + 'px';
                canvas.style.height = (containerWidth / aspectRatio) + 'px';
            } else {
                canvas.style.width = '800px';
                canvas.style.height = '400px';
            }
        }

        // Handle window resize
        window.addEventListener('resize', resizeCanvas);
        document.addEventListener('DOMContentLoaded', resizeCanvas);
    </script>
</body>
</html>